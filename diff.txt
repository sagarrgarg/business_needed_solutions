diff --git a/business_needed_solutions/business_needed_solutions/doctype/bns_settings/bns_settings.js b/business_needed_solutions/business_needed_solutions/doctype/bns_settings/bns_settings.js
index 19e8654..e69de29 100644
--- a/business_needed_solutions/business_needed_solutions/doctype/bns_settings/bns_settings.js
+++ b/business_needed_solutions/business_needed_solutions/doctype/bns_settings/bns_settings.js
@@ -1,28 +0,0 @@
-// Copyright (c) 2025, Sagar Ratan Garg and contributors
-// For license information, please see license.txt
-
-// frappe.ui.form.on("BNS Settings", {
-// 	refresh(frm) {
-
-// 	},
-// });
-frappe.ui.form.on('BNS Settings', {
-    refresh: function(frm) {
-        frm.add_custom_button(__('Apply List View Settings'), function() {
-            frm.call({
-                doc: frm.doc,
-                method: 'apply_settings',
-                freeze: true,
-                freeze_message: __('Applying Settings...'),
-                callback: function(r) {
-                    if (r.message) {
-                        frappe.show_alert({
-                            message: __('Settings Applied Successfully'),
-                            indicator: 'green'
-                        });
-                    }
-                }
-            });
-        }, __('Actions'));
-    }
-});
\ No newline at end of file
diff --git a/business_needed_solutions/business_needed_solutions/migration.py b/business_needed_solutions/business_needed_solutions/migration.py
index 7036c12..c7998dd 100644
--- a/business_needed_solutions/business_needed_solutions/migration.py
+++ b/business_needed_solutions/business_needed_solutions/migration.py
@@ -51,15 +51,14 @@ def add_bns_status_option():
     - Purchase Receipt
     - Sales Invoice
     - Purchase Invoice
+    
+    This function APPENDS the status option instead of overwriting to preserve
+    system statuses that may be added in future ERPNext versions.
     """
-    doctypes_status_options = {
-        "Delivery Note": "\nDraft\nTo Bill\nCompleted\nReturn Issued\nCancelled\nClosed\nBNS Internally Transferred",
-        "Purchase Receipt": "\nDraft\nPartly Billed\nTo Bill\nCompleted\nReturn Issued\nCancelled\nClosed\nBNS Internally Transferred",
-        "Sales Invoice": "\nDraft\nReturn\nCredit Note Issued\nSubmitted\nPaid\nPartly Paid\nUnpaid\nUnpaid and Discounted\nPartly Paid and Discounted\nOverdue and Discounted\nOverdue\nCancelled\nInternal Transfer\nBNS Internally Transferred",
-        "Purchase Invoice": "\nDraft\nReturn\nDebit Note Issued\nSubmitted\nPaid\nPartly Paid\nUnpaid\nOverdue\nCancelled\nInternal Transfer\nBNS Internally Transferred"
-    }
+    new_status = "BNS Internally Transferred"
+    doctypes = ["Delivery Note", "Purchase Receipt", "Sales Invoice", "Purchase Invoice"]
     
-    for doctype, new_options in doctypes_status_options.items():
+    for doctype in doctypes:
         try:
             # Check if property setter already exists
             existing_ps_name = frappe.db.exists("Property Setter", {
@@ -69,17 +68,34 @@ def add_bns_status_option():
             })
             
             if existing_ps_name:
-                # Update existing property setter
+                # Update existing property setter - APPEND only if missing
                 ps = frappe.get_doc("Property Setter", existing_ps_name)
                 # Check if BNS Internally Transferred is already in options
-                if "BNS Internally Transferred" not in ps.value:
-                    ps.value = new_options
+                existing_options = ps.value.split('\n') if ps.value else []
+                if new_status not in existing_options:
+                    # Append the new status option
+                    ps.value = ps.value + "\n" + new_status
                     ps.save(ignore_permissions=True)
                     frappe.db.commit()
-                    logger.info(f"Updated status options for {doctype}")
+                    logger.info(f"Appended '{new_status}' to status options for {doctype}")
                 else:
-                    logger.info(f"Status option already exists for {doctype}")
+                    logger.info(f"Status option '{new_status}' already exists for {doctype}")
             else:
+                # Get default options from DocField if available
+                try:
+                    meta = frappe.get_meta(doctype)
+                    status_field = meta.get_field("status")
+                    default_options = status_field.options or ""
+                except Exception:
+                    default_options = ""
+                
+                # Append new status to default options
+                if default_options:
+                    new_value = default_options + "\n" + new_status
+                else:
+                    # Fallback: use newline-separated format
+                    new_value = "\n" + new_status
+                
                 # Create new property setter
                 ps = frappe.new_doc("Property Setter")
                 ps.update({
@@ -87,12 +103,12 @@ def add_bns_status_option():
                     "doc_type": doctype,
                     "field_name": "status",
                     "property": "options",
-                    "value": new_options,
+                    "value": new_value,
                     "property_type": "Text"
                 })
                 ps.save(ignore_permissions=True)
                 frappe.db.commit()
-                logger.info(f"Created status options property setter for {doctype}")
+                logger.info(f"Created status options property setter for {doctype} with '{new_status}'")
                 
         except Exception as e:
             logger.error(f"Error adding BNS status option for {doctype}: {str(e)}")
diff --git a/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.js b/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.js
index 35c266a..354e7b4 100644
--- a/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.js
+++ b/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.js
@@ -25,6 +25,13 @@ frappe.query_reports["Internal Transfer Receive Mismatch"] = {
 				}
 			}
 		},
+		{
+			"fieldname": "company_address",
+			"label": __("Company Address"),
+			"fieldtype": "Link",
+			"options": "Address",
+			"reqd": 0
+		},
 		{
 			"fieldname": "from_date",
 			"label": __("From Date"),
@@ -39,6 +46,19 @@ frappe.query_reports["Internal Transfer Receive Mismatch"] = {
 			"default": frappe.datetime.get_today(),
 			"reqd": 0
 		}
-	]
+	],
+	"onload": function(report) {
+		// Set up company_address query filter
+		if (report.get_filter('company_address')) {
+			report.get_filter('company_address').df.get_query = function() {
+				return {
+					query: "business_needed_solutions.business_needed_solutions.business_needed_solutions.report.internal_transfer_receive_mismatch.internal_transfer_receive_mismatch.company_address_query",
+					filters: {
+						"is_company_address": 1
+					}
+				}
+			}
+		}
+	}
 };
 
diff --git a/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.json b/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.json
index 510c36f..b7c8ce6 100644
--- a/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.json
+++ b/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.json
@@ -6,7 +6,36 @@
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Report",
- "filters": [],
+ "filters": [
+  {
+   "fieldname": "company",
+   "label": "Company",
+   "fieldtype": "Link",
+   "options": "Company"
+  },
+  {
+   "fieldname": "customer",
+   "label": "Customer",
+   "fieldtype": "Link",
+   "options": "Customer"
+  },
+  {
+   "fieldname": "company_address",
+   "label": "Company Address",
+   "fieldtype": "Link",
+   "options": "Address"
+  },
+  {
+   "fieldname": "from_date",
+   "label": "From Date",
+   "fieldtype": "Date"
+  },
+  {
+   "fieldname": "to_date",
+   "label": "To Date",
+   "fieldtype": "Date"
+  }
+ ],
  "idx": 0,
  "is_standard": "Yes",
  "letterhead": null,
diff --git a/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.py b/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.py
index 4622086..54953f1 100644
--- a/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.py
+++ b/business_needed_solutions/business_needed_solutions/report/internal_transfer_receive_mismatch/internal_transfer_receive_mismatch.py
@@ -29,6 +29,41 @@ from frappe import _
 from frappe.utils import today
 
 
+@frappe.whitelist()
+def company_address_query(doctype, txt, searchfield, start, page_len, filters):
+	"""
+	Query to fetch only company addresses for the report filter.
+	"""
+	conditions = ["is_company_address = 1"]
+	values = []
+
+	if txt:
+		conditions.append(f"{searchfield} like %s")
+		values.append(f"%{txt}%")
+
+	# If company filter is provided, try to match via address title
+	company = None
+	if filters:
+		company = filters.get("company")
+		if company:
+			conditions.append("address_title = %s")
+			values.append(company)
+
+	where_clause = " AND ".join(conditions)
+	query = f"""
+		SELECT
+			name,
+			IFNULL(address_title, name) AS address_title
+		FROM `tabAddress`
+		WHERE {where_clause}
+		ORDER BY modified DESC
+		LIMIT %s
+		OFFSET %s
+	"""
+	values.extend([page_len, start])
+	return frappe.db.sql(query, tuple(values))
+
+
 def execute(filters=None):
 	"""
 	Execute the report and return columns and data.
@@ -75,6 +110,18 @@ def get_columns():
 			"options": "document_type",
 			"width": 150
 		},
+		{
+			"fieldname": "company_address_name",
+			"label": _("Company Address (Name)"),
+			"fieldtype": "Data",
+			"width": 180
+		},
+		{
+			"fieldname": "customer_address_name",
+			"label": _("Customer Address (Name)"),
+			"fieldtype": "Data",
+			"width": 180
+		},
 		{
 			"fieldname": "grand_total",
 			"label": _("Grand Total"),
@@ -164,6 +211,10 @@ def get_delivery_note_mismatches(filters=None):
 			conditions.append("dn.customer = %s")
 			values.append(filters.customer)
 		
+		if filters.get("company_address"):
+			conditions.append("dn.company_address = %s")
+			values.append(filters.company_address)
+		
 		if filters.get("from_date"):
 			conditions.append("dn.posting_date >= %s")
 			values.append(filters.from_date)
@@ -179,7 +230,9 @@ def get_delivery_note_mismatches(filters=None):
 		SELECT 
 			dn.posting_date,
 			dn.name,
-			dn.grand_total
+			dn.grand_total,
+			dn.company_address as company_address_name,
+			dn.customer_address as customer_address_name
 		FROM 
 			`tabDelivery Note` dn
 		JOIN 
@@ -346,6 +399,8 @@ def get_delivery_note_mismatches(filters=None):
 			"document_type": "Delivery Note",
 			"document_name": dn_name,
 			"grand_total": dn.get("grand_total") or 0.0,
+			"company_address_name": dn.get("company_address_name") or "",
+			"customer_address_name": dn.get("customer_address_name") or "",
 			"missing_document": missing_doc,
 			"mismatch_reason": mismatch_reason,
 			"purchase_receipt": purchase_receipt,
@@ -383,6 +438,10 @@ def get_sales_invoice_mismatches(filters=None):
 			conditions.append("si.customer = %s")
 			values.append(filters.customer)
 		
+		if filters.get("company_address"):
+			conditions.append("si.company_address = %s")
+			values.append(filters.company_address)
+		
 		if filters.get("from_date"):
 			conditions.append("si.posting_date >= %s")
 			values.append(filters.from_date)
@@ -398,7 +457,9 @@ def get_sales_invoice_mismatches(filters=None):
 		SELECT 
 			si.posting_date,
 			si.name,
-			si.grand_total
+			si.grand_total,
+			si.company_address as company_address_name,
+			si.customer_address as customer_address_name
 		FROM 
 			`tabSales Invoice` si
 		JOIN 
@@ -464,6 +525,8 @@ def get_sales_invoice_mismatches(filters=None):
 				"document_type": "Sales Invoice",
 				"document_name": si_name,
 				"grand_total": si.get("grand_total") or 0.0,
+				"company_address_name": si.get("company_address_name") or "",
+				"customer_address_name": si.get("customer_address_name") or "",
 				"missing_document": " / ".join(missing_docs) if missing_docs else "Purchase Invoice / Purchase Receipt",
 				"mismatch_reason": " | ".join(reasons) if reasons else "Mismatch detected",
 				"purchase_receipt": pr_mismatch.get("purchase_receipt") if pr_mismatch else None,
diff --git a/business_needed_solutions/business_needed_solutions/utils.py b/business_needed_solutions/business_needed_solutions/utils.py
index 71a1e72..7bf36d2 100644
--- a/business_needed_solutions/business_needed_solutions/utils.py
+++ b/business_needed_solutions/business_needed_solutions/utils.py
@@ -227,11 +227,10 @@ def _find_internal_supplier(company: str) -> str:
 
 
 def _update_delivery_note_reference(dn_name: str, pr_name: str) -> None:
-    """Update delivery note with purchase receipt reference and status."""
+    """Update delivery note with purchase receipt reference."""
+    # Do NOT update status here - it's handled by on_submit hook
     frappe.db.set_value("Delivery Note", dn_name, {
-        "bns_inter_company_reference": pr_name,
-        "status": "BNS Internally Transferred",
-        "per_billed": 100
+        "bns_inter_company_reference": pr_name
     })
 
 
@@ -325,13 +324,17 @@ def update_delivery_note_status_for_bns_internal(doc, method: Optional[str] = No
     if doc.docstatus != 1:
         return
     
+    # Guard: prevent infinite loops - if already updated, skip
+    if doc.status == "BNS Internally Transferred":
+        return
+    
     # Check if customer is BNS internal
     is_bns_internal = doc.get("is_bns_internal_customer") or False
     if not is_bns_internal:
         customer_internal = frappe.db.get_value("Customer", doc.customer, "is_bns_internal_customer")
         if not customer_internal:
             return
-
+    
     try:
         # Check GSTIN match
         billing_address_gstin = getattr(doc, 'billing_address_gstin', None)
@@ -341,21 +344,15 @@ def update_delivery_note_status_for_bns_internal(doc, method: Optional[str] = No
             if billing_address_gstin == company_gstin:
                 # SAME GSTIN - Set as internal transfer
                 per_billed = 100
-                update_fields = {
-                    "status": "BNS Internally Transferred",
-                    "per_billed": per_billed,
-                    "is_bns_internal_customer": 1
-                }
-                frappe.db.set_value("Delivery Note", doc.name, update_fields)
+                doc.db_set("status", "BNS Internally Transferred", update_modified=False)
+                doc.db_set("per_billed", per_billed, update_modified=False)
+                doc.db_set("is_bns_internal_customer", 1, update_modified=False)
                 frappe.clear_cache(doctype="Delivery Note")
                 logger.info(f"Updated Delivery Note {doc.name} status to BNS Internally Transferred (same GSTIN)")
             else:
                 # DIFFERENT GSTIN - Set as To Bill
-                update_fields = {
-                    "status": "To Bill",
-                    "is_bns_internal_customer": 0
-                }
-                frappe.db.set_value("Delivery Note", doc.name, update_fields)
+                doc.db_set("status", "To Bill", update_modified=False)
+                doc.db_set("is_bns_internal_customer", 0, update_modified=False)
                 frappe.clear_cache(doctype="Delivery Note")
                 logger.info(f"Updated Delivery Note {doc.name} status to To Bill (different GSTIN)")
         
@@ -383,6 +380,10 @@ def update_purchase_receipt_status_for_bns_internal(doc, method: Optional[str] =
     """
     if doc.docstatus != 1:
         return
+    
+    # Guard: prevent infinite loops - if already updated, skip
+    if doc.status == "BNS Internally Transferred":
+        return
 
     try:
         # Check if PR is from DN (same GSTIN) or SI (different GSTIN)
@@ -422,26 +423,19 @@ def update_purchase_receipt_status_for_bns_internal(doc, method: Optional[str] =
         if is_bns_internal:
             # TRANSFER UNDER SAME GSTIN - from DN
             per_billed = 100
-            update_fields = {
-                "status": "BNS Internally Transferred",
-                "per_billed": per_billed,
-                "is_bns_internal_customer": 1
-            }
+            doc.db_set("status", "BNS Internally Transferred", update_modified=False)
+            doc.db_set("per_billed", per_billed, update_modified=False)
+            doc.db_set("is_bns_internal_customer", 1, update_modified=False)
             if doc.represents_company:
-                update_fields["represents_company"] = doc.represents_company
-            frappe.db.set_value("Purchase Receipt", doc.name, update_fields)
+                doc.db_set("represents_company", doc.represents_company, update_modified=False)
             frappe.clear_cache(doctype="Purchase Receipt")
             logger.info(f"Updated Purchase Receipt {doc.name} status to BNS Internally Transferred (from DN)")
         else:
             # TRANSFER UNDER DIFFERENT GSTIN - from SI
             # Status should remain "To Bill" (default), but ensure it's set
-            current_status = frappe.db.get_value("Purchase Receipt", doc.name, "status")
-            update_fields = {
-                "is_bns_internal_customer": 0
-            }
-            if current_status != "To Bill":
-                update_fields["status"] = "To Bill"
-            frappe.db.set_value("Purchase Receipt", doc.name, update_fields)
+            if doc.status != "To Bill":
+                doc.db_set("status", "To Bill", update_modified=False)
+            doc.db_set("is_bns_internal_customer", 0, update_modified=False)
             frappe.clear_cache(doctype="Purchase Receipt")
             logger.info(f"Updated Purchase Receipt {doc.name} status to To Bill (from SI)")
         
@@ -742,10 +736,10 @@ def _clear_item_level_fields_pi(target) -> None:
 
 
 def _update_sales_invoice_reference(si_name: str, pi_name: str) -> None:
-    """Update sales invoice with purchase invoice reference and status."""
+    """Update sales invoice with purchase invoice reference."""
+    # Do NOT update status here - it's handled by on_submit hook
     frappe.db.set_value("Sales Invoice", si_name, {
-        "bns_inter_company_reference": pi_name,
-        "status": "BNS Internally Transferred"
+        "bns_inter_company_reference": pi_name
     })
 
 
@@ -862,7 +856,7 @@ def _update_details_pr_from_si(source_doc, target_doc, source_parent) -> None:
         target_doc.supplier = supplier
         
         target_doc.buying_price_list = source_doc.selling_price_list
-        target_doc.is_internal_supplier = 1
+        # Do NOT set is_internal_supplier - only set bns_inter_company_reference for BNS internal transfers
         target_doc.bns_inter_company_reference = source_doc.name
         
         # Set supplier_delivery_note = SI name (TRANSFER UNDER DIFFERENT GSTIN)
@@ -879,7 +873,7 @@ def _update_details_pr_from_si(source_doc, target_doc, source_parent) -> None:
         target_doc.supplier = supplier
         
         target_doc.buying_price_list = source_doc.selling_price_list
-        target_doc.is_internal_supplier = 1
+        # Do NOT set is_internal_supplier - only set bns_inter_company_reference for BNS internal transfers
         target_doc.bns_inter_company_reference = source_doc.name
         
         # Set supplier_delivery_note = SI name (TRANSFER UNDER DIFFERENT GSTIN)
@@ -908,13 +902,9 @@ def _update_item_pr_from_si(source, target, source_parent) -> None:
 def _update_sales_invoice_pr_reference(si_name: str, pr_name: str) -> None:
     """Update sales invoice with purchase receipt reference."""
     # Note: Sales Invoice doesn't have a direct PR reference field like DN does
-    # We can store it in a custom field if needed, or just update status
-    # For now, we'll just ensure status is updated if not already set
-    current_status = frappe.db.get_value("Sales Invoice", si_name, "status")
-    if current_status != "BNS Internally Transferred":
-        frappe.db.set_value("Sales Invoice", si_name, {
-            "status": "BNS Internally Transferred"
-        })
+    # Do NOT update status here - it's handled by on_submit hook
+    # Status will be updated automatically when SI is submitted
+    pass
 
 
 def update_sales_invoice_status_for_bns_internal(doc, method: Optional[str] = None) -> None:
@@ -926,6 +916,10 @@ def update_sales_invoice_status_for_bns_internal(doc, method: Optional[str] = No
         doc: The Sales Invoice document
         method (Optional[str]): The method being called
     """
+    # Guard: prevent infinite loops - if already updated, skip
+    if doc.status == "BNS Internally Transferred":
+        return
+    
     # Ensure is_bns_internal_customer is set from Customer if not already set
     if not doc.get("is_bns_internal_customer") and doc.customer:
         customer_internal = frappe.db.get_value("Customer", doc.customer, "is_bns_internal_customer")
@@ -938,8 +932,8 @@ def update_sales_invoice_status_for_bns_internal(doc, method: Optional[str] = No
     try:
         # Update status immediately on the document object so it shows without refresh
         doc.status = "BNS Internally Transferred"
-        # Also update in database
-        frappe.db.set_value("Sales Invoice", doc.name, "status", "BNS Internally Transferred", update_modified=False)
+        # Also update in database using db_set
+        doc.db_set("status", "BNS Internally Transferred", update_modified=False)
         frappe.clear_cache(doctype="Sales Invoice")
         logger.info(f"Updated Sales Invoice {doc.name} status to BNS Internally Transferred")
         
@@ -964,6 +958,10 @@ def update_purchase_invoice_status_for_bns_internal(doc, method: Optional[str] =
     if doc.docstatus != 1:
         return
     
+    # Guard: prevent infinite loops - if already updated, skip
+    if doc.status == "BNS Internally Transferred":
+        return
+    
     # Check if it's a BNS internal transfer
     is_bns_internal = doc.get("is_bns_internal_supplier") or False
     is_from_si = False
@@ -1016,16 +1014,12 @@ def update_purchase_invoice_status_for_bns_internal(doc, method: Optional[str] =
             if represents_company:
                 doc.represents_company = represents_company
         
-        # Update status immediately on document and in database
+        # Update status immediately on document and in database using db_set
         doc.status = "BNS Internally Transferred"
-        update_fields = {
-            "status": "BNS Internally Transferred",
-            "is_bns_internal_supplier": 1
-        }
+        doc.db_set("status", "BNS Internally Transferred", update_modified=False)
+        doc.db_set("is_bns_internal_supplier", 1, update_modified=False)
         if doc.represents_company:
-            update_fields["represents_company"] = doc.represents_company
-        
-        frappe.db.set_value("Purchase Invoice", doc.name, update_fields)
+            doc.db_set("represents_company", doc.represents_company, update_modified=False)
         frappe.clear_cache(doctype="Purchase Invoice")
         logger.info(f"Updated Purchase Invoice {doc.name} status to BNS Internally Transferred")
         
diff --git a/business_needed_solutions/fixtures/custom_field.json b/business_needed_solutions/fixtures/custom_field.json
index 4bca311..b525ea8 100644
--- a/business_needed_solutions/fixtures/custom_field.json
+++ b/business_needed_solutions/fixtures/custom_field.json
@@ -2278,5 +2278,62 @@
   "translatable": 0,
   "unique": 0,
   "width": null
+ },
+ {
+  "allow_in_quick_entry": 0,
+  "allow_on_submit": 0,
+  "bold": 0,
+  "collapsible": 0,
+  "collapsible_depends_on": null,
+  "columns": 0,
+  "default": null,
+  "depends_on": null,
+  "description": null,
+  "docstatus": 0,
+  "doctype": "Custom Field",
+  "dt": "Purchase Invoice",
+  "fetch_from": null,
+  "fetch_if_empty": 0,
+  "fieldname": "bns_inter_company_reference",
+  "fieldtype": "Data",
+  "hidden": 0,
+  "hide_border": 0,
+  "hide_days": 0,
+  "hide_seconds": 0,
+  "ignore_user_permissions": 0,
+  "ignore_xss_filter": 0,
+  "in_global_search": 0,
+  "in_list_view": 0,
+  "in_preview": 0,
+  "in_standard_filter": 0,
+  "insert_after": "is_bns_internal_supplier",
+  "is_system_generated": 0,
+  "is_virtual": 0,
+  "label": "BNS Inter Company Reference",
+  "length": 0,
+  "link_filters": null,
+  "mandatory_depends_on": null,
+  "modified": "2025-11-24 12:00:00",
+  "module": "Business Needed Solutions",
+  "name": "Purchase Invoice-bns_inter_company_reference",
+  "no_copy": 0,
+  "non_negative": 0,
+  "options": null,
+  "permlevel": 0,
+  "placeholder": null,
+  "precision": "",
+  "print_hide": 0,
+  "print_hide_if_no_value": 0,
+  "print_width": null,
+  "read_only": 1,
+  "read_only_depends_on": null,
+  "report_hide": 0,
+  "reqd": 0,
+  "search_index": 0,
+  "show_dashboard": 0,
+  "sort_options": 0,
+  "translatable": 0,
+  "unique": 0,
+  "width": null
  }
 ]
\ No newline at end of file
diff --git a/diff.txt b/diff.txt
index b36d1f1..a6cb761 100644
--- a/diff.txt
+++ b/diff.txt
@@ -1,1279 +0,0 @@
-diff --git a/business_needed_solutions/business_needed_solutions/migration.py b/business_needed_solutions/business_needed_solutions/migration.py
-index d2653ac..7036c12 100644
---- a/business_needed_solutions/business_needed_solutions/migration.py
-+++ b/business_needed_solutions/business_needed_solutions/migration.py
-@@ -20,10 +20,14 @@ def after_migrate():
-     This function is called after every migration and ensures that:
-     1. Property setters for discount fields are applied
-     2. All doctypes reflect the correct discount type configuration
-+    3. Status field options include "BNS Internally Transferred"
-     """
-     try:
-         logger.info("Starting BNS post-migration setup...")
-         
-+        # Add "BNS Internally Transferred" to status field options
-+        add_bns_status_option()
-+        
-         # Apply existing BNS Settings to ensure all property setters are up to date
-         if frappe.db.exists("BNS Settings"):
-             bns_settings = frappe.get_doc("BNS Settings")
-@@ -38,3 +42,59 @@ def after_migrate():
-         logger.error(f"Error in BNS post-migration setup: {str(e)}")
-         # Don't raise the exception to avoid blocking the migration process
-         # The settings can be applied manually if needed
-+
-+
-+def add_bns_status_option():
-+    """
-+    Add "BNS Internally Transferred" to status field options for:
-+    - Delivery Note
-+    - Purchase Receipt
-+    - Sales Invoice
-+    - Purchase Invoice
-+    """
-+    doctypes_status_options = {
-+        "Delivery Note": "\nDraft\nTo Bill\nCompleted\nReturn Issued\nCancelled\nClosed\nBNS Internally Transferred",
-+        "Purchase Receipt": "\nDraft\nPartly Billed\nTo Bill\nCompleted\nReturn Issued\nCancelled\nClosed\nBNS Internally Transferred",
-+        "Sales Invoice": "\nDraft\nReturn\nCredit Note Issued\nSubmitted\nPaid\nPartly Paid\nUnpaid\nUnpaid and Discounted\nPartly Paid and Discounted\nOverdue and Discounted\nOverdue\nCancelled\nInternal Transfer\nBNS Internally Transferred",
-+        "Purchase Invoice": "\nDraft\nReturn\nDebit Note Issued\nSubmitted\nPaid\nPartly Paid\nUnpaid\nOverdue\nCancelled\nInternal Transfer\nBNS Internally Transferred"
-+    }
-+    
-+    for doctype, new_options in doctypes_status_options.items():
-+        try:
-+            # Check if property setter already exists
-+            existing_ps_name = frappe.db.exists("Property Setter", {
-+                "doc_type": doctype,
-+                "field_name": "status",
-+                "property": "options"
-+            })
-+            
-+            if existing_ps_name:
-+                # Update existing property setter
-+                ps = frappe.get_doc("Property Setter", existing_ps_name)
-+                # Check if BNS Internally Transferred is already in options
-+                if "BNS Internally Transferred" not in ps.value:
-+                    ps.value = new_options
-+                    ps.save(ignore_permissions=True)
-+                    frappe.db.commit()
-+                    logger.info(f"Updated status options for {doctype}")
-+                else:
-+                    logger.info(f"Status option already exists for {doctype}")
-+            else:
-+                # Create new property setter
-+                ps = frappe.new_doc("Property Setter")
-+                ps.update({
-+                    "doctype_or_field": "DocField",
-+                    "doc_type": doctype,
-+                    "field_name": "status",
-+                    "property": "options",
-+                    "value": new_options,
-+                    "property_type": "Text"
-+                })
-+                ps.save(ignore_permissions=True)
-+                frappe.db.commit()
-+                logger.info(f"Created status options property setter for {doctype}")
-+                
-+        except Exception as e:
-+            logger.error(f"Error adding BNS status option for {doctype}: {str(e)}")
-+            frappe.db.rollback()
-+            # Continue with other doctypes even if one fails
-diff --git a/business_needed_solutions/business_needed_solutions/utils.py b/business_needed_solutions/business_needed_solutions/utils.py
-index e9f2733..71a1e72 100644
---- a/business_needed_solutions/business_needed_solutions/utils.py
-+++ b/business_needed_solutions/business_needed_solutions/utils.py
-@@ -144,7 +144,15 @@ def _clear_document_level_fields(target) -> None:
- 
- 
- def _update_details(source_doc, target_doc, source_parent) -> None:
--    """Update details for the Purchase Receipt."""
-+    """
-+    Update details for the Purchase Receipt from Delivery Note.
-+    
-+    TRANSFER UNDER SAME GSTIN:
-+    - is_bns_internal_customer = 1
-+    - status = "BNS Internally Transferred" (set on submit)
-+    - supplier_delivery_note = DN name
-+    - per_billed = 100% (set on submit)
-+    """
-     # Handle case where source_parent might be None (when called as postprocess)
-     if source_parent is None:
-         # This is being called as a postprocess function, so we need to get the data differently
-@@ -161,6 +169,12 @@ def _update_details(source_doc, target_doc, source_parent) -> None:
-         target_doc.is_internal_supplier = 1
-         target_doc.bns_inter_company_reference = source_doc.name
-         
-+        # Set supplier_delivery_note = DN name (TRANSFER UNDER SAME GSTIN)
-+        target_doc.supplier_delivery_note = source_doc.name
-+        
-+        # Set is_bns_internal_customer = 1 (TRANSFER UNDER SAME GSTIN)
-+        target_doc.is_bns_internal_customer = 1
-+        
-         # Handle addresses
-         _update_addresses(target_doc, source_doc)
-         
-@@ -179,6 +193,12 @@ def _update_details(source_doc, target_doc, source_parent) -> None:
-         target_doc.is_internal_supplier = 1
-         target_doc.bns_inter_company_reference = source_doc.name
-         
-+        # Set supplier_delivery_note = DN name (TRANSFER UNDER SAME GSTIN)
-+        target_doc.supplier_delivery_note = source_doc.name
-+        
-+        # Set is_bns_internal_customer = 1 (TRANSFER UNDER SAME GSTIN)
-+        target_doc.is_bns_internal_customer = 1
-+        
-         # Update delivery note with reference
-         _update_delivery_note_reference(source_doc.name, target_doc.name)
-         
-@@ -223,16 +243,25 @@ def _update_addresses(target_doc, source_doc) -> None:
-         update_address(target_doc, "supplier_address", "address_display", source_doc.company_address)
-         # Keep shipping address as is
-         update_address(target_doc, "shipping_address", "shipping_address_display", source_doc.shipping_address_name)
--        # Keep dispatch address as is
--        if source_doc.dispatch_address_name:
--            update_address(target_doc, "dispatch_address", "dispatch_address_display", source_doc.dispatch_address_name)
-         # Customer address becomes billing address
-         update_address(target_doc, "billing_address", "billing_address_display", source_doc.customer_address)
-+        # Explicitly clear dispatch address and templates for BNS internal transfers
-+        target_doc.dispatch_address = None
-+        target_doc.dispatch_address_name = None
-+        target_doc.dispatch_address_display = None
-+        target_doc.dispatch_address_template = None
-+        target_doc.shipping_address_template = None
-     else:
-         # For other doctypes, use the original swapping logic
-         update_address(target_doc, "supplier_address", "address_display", source_doc.company_address)
-         update_address(target_doc, "shipping_address", "shipping_address_display", source_doc.customer_address)
-         update_address(target_doc, "billing_address", "billing_address_display", source_doc.customer_address)
-+        # Explicitly clear dispatch address and templates for BNS internal transfers
-+        target_doc.dispatch_address = None
-+        target_doc.dispatch_address_name = None
-+        target_doc.dispatch_address_display = None
-+        target_doc.dispatch_address_template = None
-+        target_doc.shipping_address_template = None
- 
- 
- def _update_taxes(target_doc) -> None:
-@@ -278,20 +307,57 @@ def _clear_item_level_fields(target) -> None:
- 
- def update_delivery_note_status_for_bns_internal(doc, method: Optional[str] = None) -> None:
-     """
--    Update the status of a Delivery Note to "BNS Internally Transferred" 
--    when submitted for a BNS internal customer.
-+    Update the status of a Delivery Note based on GSTIN match.
-+    
-+    TRANSFER UNDER SAME GSTIN:
-+    - is_bns_internal_customer = 1
-+    - status = "BNS Internally Transferred"
-+    - per_billed = 100%
-+    
-+    TRANSFER UNDER DIFFERENT GSTIN:
-+    - is_bns_internal_customer = 0
-+    - status = "To Bill"
-     
-     Args:
-         doc: The Delivery Note document
-         method (Optional[str]): The method being called
-     """
--    if not _should_update_internal_status(doc, "is_bns_internal_customer"):
-+    if doc.docstatus != 1:
-         return
-+    
-+    # Check if customer is BNS internal
-+    is_bns_internal = doc.get("is_bns_internal_customer") or False
-+    if not is_bns_internal:
-+        customer_internal = frappe.db.get_value("Customer", doc.customer, "is_bns_internal_customer")
-+        if not customer_internal:
-+            return
- 
-     try:
--        per_billed = _calculate_per_billed(doc)
--        _update_document_status(doc, "Delivery Note", per_billed)
--        logger.info(f"Updated Delivery Note {doc.name} status to BNS Internally Transferred")
-+        # Check GSTIN match
-+        billing_address_gstin = getattr(doc, 'billing_address_gstin', None)
-+        company_gstin = getattr(doc, 'company_gstin', None)
-+        
-+        if billing_address_gstin is not None and company_gstin is not None:
-+            if billing_address_gstin == company_gstin:
-+                # SAME GSTIN - Set as internal transfer
-+                per_billed = 100
-+                update_fields = {
-+                    "status": "BNS Internally Transferred",
-+                    "per_billed": per_billed,
-+                    "is_bns_internal_customer": 1
-+                }
-+                frappe.db.set_value("Delivery Note", doc.name, update_fields)
-+                frappe.clear_cache(doctype="Delivery Note")
-+                logger.info(f"Updated Delivery Note {doc.name} status to BNS Internally Transferred (same GSTIN)")
-+            else:
-+                # DIFFERENT GSTIN - Set as To Bill
-+                update_fields = {
-+                    "status": "To Bill",
-+                    "is_bns_internal_customer": 0
-+                }
-+                frappe.db.set_value("Delivery Note", doc.name, update_fields)
-+                frappe.clear_cache(doctype="Delivery Note")
-+                logger.info(f"Updated Delivery Note {doc.name} status to To Bill (different GSTIN)")
-         
-     except Exception as e:
-         logger.error(f"Error updating Delivery Note status: {str(e)}")
-@@ -300,20 +366,84 @@ def update_delivery_note_status_for_bns_internal(doc, method: Optional[str] = No
- 
- def update_purchase_receipt_status_for_bns_internal(doc, method: Optional[str] = None) -> None:
-     """
--    Update the status of a Purchase Receipt to "BNS Internally Transferred" 
--    when submitted for a BNS internal supplier.
-+    Update the status of a Purchase Receipt based on is_bns_internal_customer.
-+    
-+    TRANSFER UNDER SAME GSTIN (from DN):
-+    - is_bns_internal_customer = 1
-+    - status = "BNS Internally Transferred"
-+    - per_billed = 100%
-+    
-+    TRANSFER UNDER DIFFERENT GSTIN (from SI):
-+    - is_bns_internal_customer = 0
-+    - status = "To Bill"
-     
-     Args:
-         doc: The Purchase Receipt document
-         method (Optional[str]): The method being called
-     """
--    if not _should_update_internal_status(doc, "is_internal_supplier", check_reference=True):
-+    if doc.docstatus != 1:
-         return
- 
-     try:
--        per_billed = _calculate_per_billed(doc)
--        _update_document_status(doc, "Purchase Receipt", per_billed)
--        logger.info(f"Updated Purchase Receipt {doc.name} status to BNS Internally Transferred")
-+        # Check if PR is from DN (same GSTIN) or SI (different GSTIN)
-+        # Check supplier_delivery_note to determine source
-+        is_bns_internal = doc.get("is_bns_internal_customer") or False
-+        
-+        # If supplier_delivery_note exists, check if it's a DN or SI
-+        if doc.supplier_delivery_note:
-+            # Check if supplier_delivery_note is a DN
-+            dn_exists = frappe.db.exists("Delivery Note", doc.supplier_delivery_note)
-+            if dn_exists:
-+                # From DN - same GSTIN
-+                is_bns_internal = True
-+                # Ensure represents_company is set
-+                dn_customer = frappe.db.get_value("Delivery Note", doc.supplier_delivery_note, "customer")
-+                if dn_customer:
-+                    represents_company = frappe.db.get_value("Customer", dn_customer, "bns_represents_company")
-+                    if represents_company:
-+                        doc.represents_company = represents_company
-+            else:
-+                # Check if it's a Sales Invoice
-+                si_exists = frappe.db.exists("Sales Invoice", doc.supplier_delivery_note)
-+                if si_exists:
-+                    # From SI - different GSTIN
-+                    is_bns_internal = False
-+                    # Ensure represents_company is set from SI's customer
-+                    si_customer = frappe.db.get_value("Sales Invoice", doc.supplier_delivery_note, "customer")
-+                    if si_customer:
-+                        represents_company = frappe.db.get_value("Customer", si_customer, "bns_represents_company")
-+                        if represents_company:
-+                            doc.represents_company = represents_company
-+        
-+        # Update is_bns_internal_customer field
-+        if is_bns_internal != doc.get("is_bns_internal_customer"):
-+            doc.is_bns_internal_customer = is_bns_internal
-+        
-+        if is_bns_internal:
-+            # TRANSFER UNDER SAME GSTIN - from DN
-+            per_billed = 100
-+            update_fields = {
-+                "status": "BNS Internally Transferred",
-+                "per_billed": per_billed,
-+                "is_bns_internal_customer": 1
-+            }
-+            if doc.represents_company:
-+                update_fields["represents_company"] = doc.represents_company
-+            frappe.db.set_value("Purchase Receipt", doc.name, update_fields)
-+            frappe.clear_cache(doctype="Purchase Receipt")
-+            logger.info(f"Updated Purchase Receipt {doc.name} status to BNS Internally Transferred (from DN)")
-+        else:
-+            # TRANSFER UNDER DIFFERENT GSTIN - from SI
-+            # Status should remain "To Bill" (default), but ensure it's set
-+            current_status = frappe.db.get_value("Purchase Receipt", doc.name, "status")
-+            update_fields = {
-+                "is_bns_internal_customer": 0
-+            }
-+            if current_status != "To Bill":
-+                update_fields["status"] = "To Bill"
-+            frappe.db.set_value("Purchase Receipt", doc.name, update_fields)
-+            frappe.clear_cache(doctype="Purchase Receipt")
-+            logger.info(f"Updated Purchase Receipt {doc.name} status to To Bill (from SI)")
-         
-     except Exception as e:
-         logger.error(f"Error updating Purchase Receipt status: {str(e)}")
-@@ -346,8 +476,645 @@ def _calculate_per_billed(doc) -> int:
- 
- def _update_document_status(doc, doctype: str, per_billed: int) -> None:
-     """Update document status and per_billed value."""
--    frappe.db.set_value(doctype, doc.name, {
--        "status": "BNS Internally Transferred",
--        "per_billed": per_billed
-+    update_fields = {
-+        "status": "BNS Internally Transferred"
-+    }
-+    
-+    # Only set per_billed for doctypes that have this field (Delivery Note, Purchase Receipt)
-+    if doctype in ["Delivery Note", "Purchase Receipt"]:
-+        update_fields["per_billed"] = per_billed
-+    
-+    frappe.db.set_value(doctype, doc.name, update_fields)
-+    frappe.clear_cache(doctype=doctype)
-+
-+
-+@frappe.whitelist()
-+def make_bns_internal_purchase_invoice(source_name: str, target_doc: Optional[Dict] = None) -> Dict:
-+    """
-+    Create a Purchase Invoice from a Sales Invoice for internal customers when GST differs.
-+    
-+    Args:
-+        source_name (str): Name of the source Sales Invoice
-+        target_doc (Optional[Dict]): Target document for mapping
-+        
-+    Returns:
-+        Dict: Mapped Purchase Invoice document
-+        
-+    Raises:
-+        BNSValidationError: If validation fails
-+        BNSInternalTransferError: If internal transfer setup fails
-+    """
-+    try:
-+        si = frappe.get_doc("Sales Invoice", source_name)
-+        
-+        # Validate sales invoice for internal customer
-+        _validate_internal_sales_invoice(si)
-+        
-+        # Get representing company
-+        represents_company = _get_representing_company_from_customer(si.customer)
-+        
-+        # Create mapped document
-+        doclist = get_mapped_doc(
-+            "Sales Invoice",
-+            source_name,
-+            _get_sales_invoice_mapping(),
-+            target_doc,
-+            _set_missing_values_pi,
-+        )
-+        
-+        # Update sales invoice with reference (this needs to be done after the document is created)
-+        _update_sales_invoice_reference(si.name, doclist.name)
-+        
-+        logger.info(f"Successfully created internal Purchase Invoice from Sales Invoice {source_name}")
-+        return doclist
-+        
-+    except Exception as e:
-+        logger.error(f"Error creating internal Purchase Invoice: {str(e)}")
-+        raise
-+
-+
-+def _validate_internal_sales_invoice(si) -> None:
-+    """Validate that the sales invoice is for an internal customer with different GST."""
-+    # Check if customer is BNS internal (only check is_bns_internal_customer)
-+    is_bns_internal = si.get("is_bns_internal_customer") or False
-+    if not is_bns_internal:
-+        # Check customer's is_bns_internal_customer field
-+        customer_internal = frappe.db.get_value("Customer", si.customer, "is_bns_internal_customer")
-+        if not customer_internal:
-+            raise BNSValidationError(_("Sales Invoice is not for a BNS internal customer"))
-+    
-+    # Validate GST mismatch condition
-+    billing_address_gstin = getattr(si, 'billing_address_gstin', None)
-+    company_gstin = getattr(si, 'company_gstin', None)
-+    
-+    if billing_address_gstin is None or company_gstin is None:
-+        raise BNSValidationError(_("GSTIN information is missing. Cannot create internal Purchase Invoice."))
-+    
-+    if billing_address_gstin == company_gstin:
-+        raise BNSValidationError(_("GSTINs are the same. Use Delivery Note/Purchase Receipt flow instead."))
-+
-+
-+def _get_representing_company_from_customer(customer: str) -> str:
-+    """Get the company that the customer represents."""
-+    represents_company = frappe.db.get_value("Customer", customer, "bns_represents_company")
-+    if not represents_company:
-+        raise BNSValidationError(_("No company is assigned to the internal customer"))
-+    return represents_company
-+
-+
-+def _get_sales_invoice_mapping() -> Dict[str, Any]:
-+    """Get the mapping configuration for Sales Invoice to Purchase Invoice."""
-+    mapping = {
-+        "Sales Invoice": {
-+            "doctype": "Purchase Invoice",
-+            "field_map": {},
-+            "field_no_map": [
-+                "set_warehouse", "cost_center", "project", "location", "bill_no", "bill_date",
-+                "dispatch_address", "dispatch_address_name", "dispatch_address_display", 
-+                "dispatch_address_template", "shipping_address_template"
-+            ],
-+            "validation": {"docstatus": ["=", 1]},
-+            "postprocess": _update_details_pi,
-+        },
-+        "Sales Invoice Item": {
-+            "doctype": "Purchase Invoice Item",
-+            "field_map": {
-+                "name": "sales_invoice_item",
-+            },
-+            "field_no_map": ["expense_account", "cost_center", "project", "location"],
-+            "postprocess": _update_item_pi,
-+        },
-+    }
-+    
-+    # Add warehouse, serial_no, batch_no mapping if update_stock is enabled
-+    # Note: We'll check this in postprocess, but prepare the mapping structure
-+    return mapping
-+
-+
-+def _set_missing_values_pi(source, target) -> None:
-+    """Set missing values for the target Purchase Invoice."""
-+    target.run_method("set_missing_values")
-+    
-+    # Clear tax template and taxes
-+    target.taxes_and_charges = None
-+    target.taxes = []
-+            
-+    if not target.get("items"):
-+        raise BNSValidationError(_("All items have already been received"))
-+    
-+    # Clear document level warehouses and accounting dimensions
-+    _clear_document_level_fields_pi(target)
-+
-+
-+def _clear_document_level_fields_pi(target) -> None:
-+    """Clear warehouse and accounting dimension fields at document level."""
-+    target.set_warehouse = None
-+    target.cost_center = None
-+    
-+    # Clear optional fields if they exist
-+    for field in ['location', 'project']:
-+        if hasattr(target, field):
-+            setattr(target, field, None)
-+
-+
-+def _update_details_pi(source_doc, target_doc, source_parent) -> None:
-+    """
-+    Update details for the Purchase Invoice from Sales Invoice.
-+    
-+    TRANSFER UNDER DIFFERENT GSTIN:
-+    - is_bns_internal_supplier = 1
-+    - supplier_invoice_number (bill_no) = SI name
-+    """
-+    # Handle case where source_parent might be None (when called as postprocess)
-+    if source_parent is None:
-+        # This is being called as a postprocess function, so we need to get the data differently
-+        # The source_doc is the Sales Invoice, and target_doc is the Purchase Invoice
-+        represents_company = _get_representing_company_from_customer(source_doc.customer)
-+        target_doc.company = represents_company
-+        
-+        # Find supplier representing the sales invoice's company
-+        supplier = _find_internal_supplier(represents_company)
-+        target_doc.supplier = supplier
-+        
-+        # Set internal transfer fields
-+        target_doc.buying_price_list = source_doc.selling_price_list
-+        # Do NOT set is_internal_supplier - only set is_bns_internal_supplier for BNS internal transfers
-+        # Use bns_inter_company_reference instead of inter_company_invoice_reference to avoid ERPNext validation
-+        target_doc.bns_inter_company_reference = source_doc.name
-+        
-+        # Set is_bns_internal_supplier = 1 (TRANSFER UNDER DIFFERENT GSTIN)
-+        target_doc.is_bns_internal_supplier = 1
-+        
-+        # Set supplier_invoice_number (bill_no) = SI name (TRANSFER UNDER DIFFERENT GSTIN)
-+        target_doc.bill_no = source_doc.name
-+        
-+        # Handle addresses
-+        _update_addresses_pi(target_doc, source_doc)
-+        
-+        # Handle taxes
-+        _update_taxes_pi(target_doc)
-+    else:
-+        # This is being called from the main function with proper parameters
-+        target_doc.company = source_parent.get("represents_company")
-+        
-+        # Find supplier representing the sales invoice's company
-+        supplier = _find_internal_supplier(source_parent.company)
-+        target_doc.supplier = supplier
-+        
-+        # Set internal transfer fields
-+        target_doc.buying_price_list = source_doc.selling_price_list
-+        # Do NOT set is_internal_supplier - only set is_bns_internal_supplier for BNS internal transfers
-+        # Use bns_inter_company_reference instead of inter_company_invoice_reference to avoid ERPNext validation
-+        target_doc.bns_inter_company_reference = source_doc.name
-+        
-+        # Set is_bns_internal_supplier = 1 (TRANSFER UNDER DIFFERENT GSTIN)
-+        target_doc.is_bns_internal_supplier = 1
-+        
-+        # Set supplier_invoice_number (bill_no) = SI name (TRANSFER UNDER DIFFERENT GSTIN)
-+        target_doc.bill_no = source_doc.name
-+        
-+        # Update sales invoice with reference
-+        _update_sales_invoice_reference(source_doc.name, target_doc.name)
-+        
-+        # Handle addresses
-+        _update_addresses_pi(target_doc, source_doc)
-+        
-+        # Handle taxes
-+        _update_taxes_pi(target_doc)
-+
-+
-+def _update_addresses_pi(target_doc, source_doc) -> None:
-+    """Update addresses for internal transfer Purchase Invoice."""
-+    # Company address becomes supplier address
-+    update_address(target_doc, "supplier_address", "address_display", source_doc.company_address)
-+    # Customer address becomes billing address
-+    update_address(target_doc, "billing_address", "billing_address_display", source_doc.customer_address)
-+    # Shipping address
-+    if source_doc.shipping_address_name:
-+        update_address(target_doc, "shipping_address", "shipping_address_display", source_doc.shipping_address_name)
-+    
-+    # Explicitly clear dispatch address and templates for BNS internal transfers
-+    target_doc.dispatch_address = None
-+    target_doc.dispatch_address_name = None
-+    target_doc.dispatch_address_display = None
-+    target_doc.dispatch_address_template = None
-+    target_doc.shipping_address_template = None
-+
-+
-+def _update_taxes_pi(target_doc) -> None:
-+    """Update taxes for the purchase invoice."""
-+    # Clear tax template and taxes - we don't want automatic tax assignment
-+    target_doc.taxes_and_charges = None
-+    target_doc.taxes = []
-+
-+
-+def _update_item_pi(source, target, source_parent) -> None:
-+    """Update item details for the purchase invoice item."""
-+    target.qty = source.qty
-+    target.stock_qty = source.stock_qty if hasattr(source, 'stock_qty') else source.qty
-+    
-+    # Map serial_no and batch_no if they exist (for stock items)
-+    if source.get("serial_no"):
-+        target.serial_no = source.serial_no
-+    if source.get("batch_no"):
-+        target.batch_no = source.batch_no
-+    
-+    # Clear accounting fields to let system auto-populate
-+    _clear_item_level_fields_pi(target)
-+    
-+    if source.get("use_serial_batch_fields"):
-+        target.set("use_serial_batch_fields", 1)
-+
-+
-+def _clear_item_level_fields_pi(target) -> None:
-+    """Clear accounting and warehouse fields at item level."""
-+    # Clear accounting fields
-+    target.expense_account = None
-+    target.cost_center = None
-+    
-+    # Clear warehouse fields
-+    target.warehouse = None
-+    
-+    # Clear other accounting dimensions
-+    for field in ['location', 'project']:
-+        if hasattr(target, field):
-+            setattr(target, field, None)
-+
-+
-+def _update_sales_invoice_reference(si_name: str, pi_name: str) -> None:
-+    """Update sales invoice with purchase invoice reference and status."""
-+    frappe.db.set_value("Sales Invoice", si_name, {
-+        "bns_inter_company_reference": pi_name,
-+        "status": "BNS Internally Transferred"
-     })
--    frappe.clear_cache(doctype=doctype) 
-\ No newline at end of file
-+
-+
-+@frappe.whitelist()
-+def make_bns_internal_purchase_receipt_from_si(source_name: str, target_doc: Optional[Dict] = None) -> Dict:
-+    """
-+    Create a Purchase Receipt from a Sales Invoice for internal customers when update_stock is enabled.
-+    
-+    Args:
-+        source_name (str): Name of the source Sales Invoice
-+        target_doc (Optional[Dict]): Target document for mapping
-+        
-+    Returns:
-+        Dict: Mapped Purchase Receipt document
-+        
-+    Raises:
-+        BNSValidationError: If validation fails
-+        BNSInternalTransferError: If internal transfer setup fails
-+    """
-+    try:
-+        si = frappe.get_doc("Sales Invoice", source_name)
-+        
-+        # Check if SI is made from Delivery Note (check items for delivery_note reference)
-+        has_dn_reference = False
-+        if si.items:
-+            has_dn_reference = any(item.get("delivery_note") for item in si.items if item.get("delivery_note"))
-+        
-+        # Validate sales invoice for internal customer
-+        # Only require update_stock if SI is NOT made from DN
-+        if not has_dn_reference and not si.get("update_stock"):
-+            raise BNSValidationError(_("Sales Invoice must have 'Update Stock' enabled to create Purchase Receipt, or must be created from a Delivery Note"))
-+        
-+        _validate_internal_sales_invoice(si)
-+        
-+        # Get representing company
-+        represents_company = _get_representing_company_from_customer(si.customer)
-+        
-+        # Create mapped document
-+        doclist = get_mapped_doc(
-+            "Sales Invoice",
-+            source_name,
-+            _get_sales_invoice_to_pr_mapping(),
-+            target_doc,
-+            _set_missing_values_pr_from_si,
-+        )
-+        
-+        # Update sales invoice with PR reference
-+        _update_sales_invoice_pr_reference(si.name, doclist.name)
-+        
-+        logger.info(f"Successfully created internal Purchase Receipt from Sales Invoice {source_name}")
-+        return doclist
-+        
-+    except Exception as e:
-+        logger.error(f"Error creating internal Purchase Receipt from Sales Invoice: {str(e)}")
-+        raise
-+
-+
-+def _get_sales_invoice_to_pr_mapping() -> Dict[str, Any]:
-+    """Get the mapping configuration for Sales Invoice to Purchase Receipt."""
-+    return {
-+        "Sales Invoice": {
-+            "doctype": "Purchase Receipt",
-+            "field_map": {},
-+            "field_no_map": [
-+                "set_warehouse", "rejected_warehouse", "cost_center", "project", "location",
-+                "dispatch_address", "dispatch_address_name", "dispatch_address_display", 
-+                "dispatch_address_template", "shipping_address_template"
-+            ],
-+            "validation": {"docstatus": ["=", 1]},
-+            "postprocess": _update_details_pr_from_si,
-+        },
-+        "Sales Invoice Item": {
-+            "doctype": "Purchase Receipt Item",
-+            "field_map": {
-+                "warehouse": "from_warehouse",
-+                "serial_no": "serial_no",
-+                "batch_no": "batch_no",
-+            },
-+            "field_no_map": ["warehouse", "rejected_warehouse", "expense_account", "cost_center", "project", "location"],
-+            "postprocess": _update_item_pr_from_si,
-+        },
-+    }
-+
-+
-+def _set_missing_values_pr_from_si(source, target) -> None:
-+    """Set missing values for the target Purchase Receipt from Sales Invoice."""
-+    target.run_method("set_missing_values")
-+    
-+    # Clear tax template and taxes
-+    target.taxes_and_charges = None
-+    target.taxes = []
-+            
-+    if not target.get("items"):
-+        raise BNSValidationError(_("All items have already been received"))
-+    
-+    # Clear document level warehouses and accounting dimensions
-+    _clear_document_level_fields(target)
-+
-+
-+def _update_details_pr_from_si(source_doc, target_doc, source_parent) -> None:
-+    """
-+    Update details for the Purchase Receipt from Sales Invoice.
-+    
-+    TRANSFER UNDER DIFFERENT GSTIN:
-+    - is_bns_internal_customer = 0
-+    - status = "To Bill" (set on submit)
-+    - supplier_delivery_note = SI name
-+    """
-+    if source_parent is None:
-+        represents_company = _get_representing_company_from_customer(source_doc.customer)
-+        target_doc.company = represents_company
-+        
-+        supplier = _find_internal_supplier(represents_company)
-+        target_doc.supplier = supplier
-+        
-+        target_doc.buying_price_list = source_doc.selling_price_list
-+        target_doc.is_internal_supplier = 1
-+        target_doc.bns_inter_company_reference = source_doc.name
-+        
-+        # Set supplier_delivery_note = SI name (TRANSFER UNDER DIFFERENT GSTIN)
-+        target_doc.supplier_delivery_note = source_doc.name
-+        
-+        # Set is_bns_internal_customer = 0 (TRANSFER UNDER DIFFERENT GSTIN)
-+        target_doc.is_bns_internal_customer = 0
-+        
-+        _update_addresses(target_doc, source_doc)
-+        _update_taxes(target_doc)
-+    else:
-+        target_doc.company = source_parent.get("represents_company")
-+        supplier = _find_internal_supplier(source_parent.company)
-+        target_doc.supplier = supplier
-+        
-+        target_doc.buying_price_list = source_doc.selling_price_list
-+        target_doc.is_internal_supplier = 1
-+        target_doc.bns_inter_company_reference = source_doc.name
-+        
-+        # Set supplier_delivery_note = SI name (TRANSFER UNDER DIFFERENT GSTIN)
-+        target_doc.supplier_delivery_note = source_doc.name
-+        
-+        # Set is_bns_internal_customer = 0 (TRANSFER UNDER DIFFERENT GSTIN)
-+        target_doc.is_bns_internal_customer = 0
-+        
-+        _update_sales_invoice_pr_reference(source_doc.name, target_doc.name)
-+        _update_addresses(target_doc, source_doc)
-+        _update_taxes(target_doc)
-+
-+
-+def _update_item_pr_from_si(source, target, source_parent) -> None:
-+    """Update item details for the purchase receipt item from sales invoice item."""
-+    target.received_qty = 0
-+    target.qty = source.qty
-+    target.stock_qty = source.stock_qty if hasattr(source, 'stock_qty') else source.qty
-+    
-+    _clear_item_level_fields(target)
-+    
-+    if source.get("use_serial_batch_fields"):
-+        target.set("use_serial_batch_fields", 1)
-+
-+
-+def _update_sales_invoice_pr_reference(si_name: str, pr_name: str) -> None:
-+    """Update sales invoice with purchase receipt reference."""
-+    # Note: Sales Invoice doesn't have a direct PR reference field like DN does
-+    # We can store it in a custom field if needed, or just update status
-+    # For now, we'll just ensure status is updated if not already set
-+    current_status = frappe.db.get_value("Sales Invoice", si_name, "status")
-+    if current_status != "BNS Internally Transferred":
-+        frappe.db.set_value("Sales Invoice", si_name, {
-+            "status": "BNS Internally Transferred"
-+        })
-+
-+
-+def update_sales_invoice_status_for_bns_internal(doc, method: Optional[str] = None) -> None:
-+    """
-+    Update the status of a Sales Invoice to "BNS Internally Transferred" 
-+    when submitted for a BNS internal customer with different GST.
-+    
-+    Args:
-+        doc: The Sales Invoice document
-+        method (Optional[str]): The method being called
-+    """
-+    # Ensure is_bns_internal_customer is set from Customer if not already set
-+    if not doc.get("is_bns_internal_customer") and doc.customer:
-+        customer_internal = frappe.db.get_value("Customer", doc.customer, "is_bns_internal_customer")
-+        if customer_internal:
-+            doc.set("is_bns_internal_customer", customer_internal)
-+    
-+    if not _should_update_sales_invoice_status(doc):
-+        return
-+
-+    try:
-+        # Update status immediately on the document object so it shows without refresh
-+        doc.status = "BNS Internally Transferred"
-+        # Also update in database
-+        frappe.db.set_value("Sales Invoice", doc.name, "status", "BNS Internally Transferred", update_modified=False)
-+        frappe.clear_cache(doctype="Sales Invoice")
-+        logger.info(f"Updated Sales Invoice {doc.name} status to BNS Internally Transferred")
-+        
-+    except Exception as e:
-+        logger.error(f"Error updating Sales Invoice status: {str(e)}")
-+        raise
-+
-+
-+def update_purchase_invoice_status_for_bns_internal(doc, method: Optional[str] = None) -> None:
-+    """
-+    Update the status of a Purchase Invoice to "BNS Internally Transferred" 
-+    when submitted for a BNS internal supplier with inter company reference.
-+    
-+    This handles:
-+    1. PI created directly from SI (has inter_company_invoice_reference)
-+    2. PI created from PR that was created from SI (check PR's supplier_delivery_note or bns_inter_company_reference)
-+    
-+    Args:
-+        doc: The Purchase Invoice document
-+        method (Optional[str]): The method being called
-+    """
-+    if doc.docstatus != 1:
-+        return
-+    
-+    # Check if it's a BNS internal transfer
-+    is_bns_internal = doc.get("is_bns_internal_supplier") or False
-+    is_from_si = False
-+    
-+    if is_bns_internal:
-+        is_from_si = True
-+    elif doc.bns_inter_company_reference:
-+        # Directly created from Sales Invoice (using bns_inter_company_reference)
-+        # Check if bns_inter_company_reference points to a Sales Invoice
-+        if frappe.db.exists("Sales Invoice", doc.bns_inter_company_reference):
-+            is_from_si = True
-+    elif doc.inter_company_invoice_reference:
-+        # Also check standard inter_company_invoice_reference for backward compatibility
-+        is_from_si = True
-+    elif doc.items:
-+        # Check if PI is created from PR that was created from SI
-+        # Get Purchase Receipt references from items
-+        pr_names = set()
-+        for item in doc.items:
-+            if item.get("purchase_receipt"):
-+                pr_names.add(item.purchase_receipt)
-+        
-+        # Check if any PR was created from SI
-+        if pr_names:
-+            for pr_name in pr_names:
-+                pr_supplier_dn = frappe.db.get_value("Purchase Receipt", pr_name, "supplier_delivery_note")
-+                pr_bns_ref = frappe.db.get_value("Purchase Receipt", pr_name, "bns_inter_company_reference")
-+                
-+                # Check if supplier_delivery_note or bns_inter_company_reference points to a Sales Invoice
-+                if pr_supplier_dn and frappe.db.exists("Sales Invoice", pr_supplier_dn):
-+                    is_from_si = True
-+                    break
-+                elif pr_bns_ref and frappe.db.exists("Sales Invoice", pr_bns_ref):
-+                    is_from_si = True
-+                    break
-+    
-+    if not is_from_si:
-+        return
-+    
-+    try:
-+        # Ensure is_bns_internal_supplier is set
-+        if not doc.get("is_bns_internal_supplier"):
-+            doc.is_bns_internal_supplier = 1
-+        
-+        # Ensure represents_company is set from supplier
-+        if not doc.represents_company and doc.supplier:
-+            represents_company = frappe.db.get_value("Supplier", doc.supplier, "bns_represents_company")
-+            if not represents_company:
-+                represents_company = frappe.db.get_value("Supplier", doc.supplier, "represents_company")
-+            if represents_company:
-+                doc.represents_company = represents_company
-+        
-+        # Update status immediately on document and in database
-+        doc.status = "BNS Internally Transferred"
-+        update_fields = {
-+            "status": "BNS Internally Transferred",
-+            "is_bns_internal_supplier": 1
-+        }
-+        if doc.represents_company:
-+            update_fields["represents_company"] = doc.represents_company
-+        
-+        frappe.db.set_value("Purchase Invoice", doc.name, update_fields)
-+        frappe.clear_cache(doctype="Purchase Invoice")
-+        logger.info(f"Updated Purchase Invoice {doc.name} status to BNS Internally Transferred")
-+        
-+    except Exception as e:
-+        logger.error(f"Error updating Purchase Invoice status: {str(e)}")
-+        raise
-+
-+
-+def _should_update_sales_invoice_status(doc) -> bool:
-+    """Check if the Sales Invoice status should be updated for internal transfers."""
-+    if doc.docstatus != 1:
-+        return False
-+    
-+    # Check if customer is BNS internal (only check is_bns_internal_customer)
-+    is_bns_internal = doc.get("is_bns_internal_customer") or False
-+    if not is_bns_internal:
-+        # Check customer's is_bns_internal_customer field
-+        customer_internal = frappe.db.get_value("Customer", doc.customer, "is_bns_internal_customer")
-+        if not customer_internal:
-+            return False
-+    
-+    # Check GST mismatch condition (different GST)
-+    billing_address_gstin = getattr(doc, 'billing_address_gstin', None)
-+    company_gstin = getattr(doc, 'company_gstin', None)
-+    
-+    if billing_address_gstin is None or company_gstin is None:
-+        return False
-+    
-+    # Only update if GST is different
-+    return billing_address_gstin != company_gstin
-+
-+
-+def validate_delivery_note_cancellation(doc, method: Optional[str] = None) -> None:
-+    """
-+    Validate that Delivery Note cannot be cancelled if Purchase Receipt exists.
-+    
-+    Args:
-+        doc: The Delivery Note document
-+        method (Optional[str]): The method being called
-+    """
-+    if doc.docstatus != 1:
-+        return
-+    
-+    try:
-+        # Check if any Purchase Receipt references this Delivery Note
-+        pr_list = frappe.get_all(
-+            "Purchase Receipt",
-+            filters={
-+                "supplier_delivery_note": doc.name,
-+                "docstatus": ["!=", 2]  # Not cancelled
-+            },
-+            fields=["name", "docstatus"],
-+            limit=1
-+        )
-+        
-+        if pr_list:
-+            pr_name = pr_list[0].name
-+            pr_status = "Submitted" if pr_list[0].docstatus == 1 else "Draft"
-+            frappe.throw(
-+                _("Cannot cancel Delivery Note {0} because Purchase Receipt {1} ({2}) references it. Please cancel the Purchase Receipt first.").format(
-+                    doc.name, pr_name, pr_status
-+                ),
-+                title=_("Cancellation Not Allowed")
-+            )
-+        
-+        # Also check via bns_inter_company_reference
-+        pr_list_bns = frappe.get_all(
-+            "Purchase Receipt",
-+            filters={
-+                "bns_inter_company_reference": doc.name,
-+                "docstatus": ["!=", 2]  # Not cancelled
-+            },
-+            fields=["name", "docstatus"],
-+            limit=1
-+        )
-+        
-+        if pr_list_bns:
-+            pr_name = pr_list_bns[0].name
-+            pr_status = "Submitted" if pr_list_bns[0].docstatus == 1 else "Draft"
-+            frappe.throw(
-+                _("Cannot cancel Delivery Note {0} because Purchase Receipt {1} ({2}) references it. Please cancel the Purchase Receipt first.").format(
-+                    doc.name, pr_name, pr_status
-+                ),
-+                title=_("Cancellation Not Allowed")
-+            )
-+        
-+    except frappe.ValidationError:
-+        raise
-+    except Exception as e:
-+        logger.error(f"Error validating Delivery Note cancellation: {str(e)}")
-+        # Don't block cancellation if there's an error, but log it
-+        pass 
-\ No newline at end of file
-diff --git a/business_needed_solutions/fixtures/custom_field.json b/business_needed_solutions/fixtures/custom_field.json
-index 78b0e9f..4bca311 100644
---- a/business_needed_solutions/fixtures/custom_field.json
-+++ b/business_needed_solutions/fixtures/custom_field.json
-@@ -1424,6 +1424,63 @@
-   "unique": 0,
-   "width": null
-  },
-+ {
-+  "allow_in_quick_entry": 0,
-+  "allow_on_submit": 0,
-+  "bold": 0,
-+  "collapsible": 0,
-+  "collapsible_depends_on": null,
-+  "columns": 0,
-+  "default": null,
-+  "depends_on": null,
-+  "description": null,
-+  "docstatus": 0,
-+  "doctype": "Custom Field",
-+  "dt": "Purchase Receipt",
-+  "fetch_from": null,
-+  "fetch_if_empty": 0,
-+  "fieldname": "is_bns_internal_customer",
-+  "fieldtype": "Check",
-+  "hidden": 0,
-+  "hide_border": 0,
-+  "hide_days": 0,
-+  "hide_seconds": 0,
-+  "ignore_user_permissions": 0,
-+  "ignore_xss_filter": 0,
-+  "in_global_search": 0,
-+  "in_list_view": 0,
-+  "in_preview": 0,
-+  "in_standard_filter": 0,
-+  "insert_after": "bns_inter_company_reference",
-+  "is_system_generated": 0,
-+  "is_virtual": 0,
-+  "label": "Is BNS Internal Customer",
-+  "length": 0,
-+  "link_filters": null,
-+  "mandatory_depends_on": null,
-+  "modified": "2025-11-26 12:00:00",
-+  "module": "Business Needed Solutions",
-+  "name": "Purchase Receipt-is_bns_internal_customer",
-+  "no_copy": 0,
-+  "non_negative": 0,
-+  "options": null,
-+  "permlevel": 0,
-+  "placeholder": null,
-+  "precision": "",
-+  "print_hide": 0,
-+  "print_hide_if_no_value": 0,
-+  "print_width": null,
-+  "read_only": 1,
-+  "read_only_depends_on": null,
-+  "report_hide": 0,
-+  "reqd": 0,
-+  "search_index": 0,
-+  "show_dashboard": 0,
-+  "sort_options": 0,
-+  "translatable": 0,
-+  "unique": 0,
-+  "width": null
-+ },
-  {
-   "allow_in_quick_entry": 0,
-   "allow_on_submit": 0,
-@@ -2107,5 +2164,119 @@
-   "translatable": 0,
-   "unique": 0,
-   "width": null
-+ },
-+ {
-+  "allow_in_quick_entry": 0,
-+  "allow_on_submit": 0,
-+  "bold": 0,
-+  "collapsible": 0,
-+  "collapsible_depends_on": null,
-+  "columns": 0,
-+  "default": null,
-+  "depends_on": null,
-+  "description": null,
-+  "docstatus": 0,
-+  "doctype": "Custom Field",
-+  "dt": "Sales Invoice",
-+  "fetch_from": "customer.is_bns_internal_customer",
-+  "fetch_if_empty": 0,
-+  "fieldname": "is_bns_internal_customer",
-+  "fieldtype": "Check",
-+  "hidden": 0,
-+  "hide_border": 0,
-+  "hide_days": 0,
-+  "hide_seconds": 0,
-+  "ignore_user_permissions": 0,
-+  "ignore_xss_filter": 0,
-+  "in_global_search": 0,
-+  "in_list_view": 0,
-+  "in_preview": 0,
-+  "in_standard_filter": 0,
-+  "insert_after": "represents_company",
-+  "is_system_generated": 0,
-+  "is_virtual": 0,
-+  "label": "Is BNS Internal Customer",
-+  "length": 0,
-+  "link_filters": null,
-+  "mandatory_depends_on": null,
-+  "modified": "2025-11-24 12:00:00",
-+  "module": "Business Needed Solutions",
-+  "name": "Sales Invoice-is_bns_internal_customer",
-+  "no_copy": 0,
-+  "non_negative": 0,
-+  "options": null,
-+  "permlevel": 0,
-+  "placeholder": null,
-+  "precision": "",
-+  "print_hide": 0,
-+  "print_hide_if_no_value": 0,
-+  "print_width": null,
-+  "read_only": 1,
-+  "read_only_depends_on": null,
-+  "report_hide": 0,
-+  "reqd": 0,
-+  "search_index": 0,
-+  "show_dashboard": 0,
-+  "sort_options": 0,
-+  "translatable": 0,
-+  "unique": 0,
-+  "width": null
-+ },
-+ {
-+  "allow_in_quick_entry": 0,
-+  "allow_on_submit": 0,
-+  "bold": 0,
-+  "collapsible": 0,
-+  "collapsible_depends_on": null,
-+  "columns": 0,
-+  "default": null,
-+  "depends_on": null,
-+  "description": null,
-+  "docstatus": 0,
-+  "doctype": "Custom Field",
-+  "dt": "Purchase Invoice",
-+  "fetch_from": null,
-+  "fetch_if_empty": 0,
-+  "fieldname": "is_bns_internal_supplier",
-+  "fieldtype": "Check",
-+  "hidden": 0,
-+  "hide_border": 0,
-+  "hide_days": 0,
-+  "hide_seconds": 0,
-+  "ignore_user_permissions": 0,
-+  "ignore_xss_filter": 0,
-+  "in_global_search": 0,
-+  "in_list_view": 0,
-+  "in_preview": 0,
-+  "in_standard_filter": 0,
-+  "insert_after": "is_internal_supplier",
-+  "is_system_generated": 0,
-+  "is_virtual": 0,
-+  "label": "Is BNS Internal Supplier",
-+  "length": 0,
-+  "link_filters": null,
-+  "mandatory_depends_on": null,
-+  "modified": "2025-11-24 12:00:00",
-+  "module": "Business Needed Solutions",
-+  "name": "Purchase Invoice-is_bns_internal_supplier",
-+  "no_copy": 0,
-+  "non_negative": 0,
-+  "options": null,
-+  "permlevel": 0,
-+  "placeholder": null,
-+  "precision": "",
-+  "print_hide": 0,
-+  "print_hide_if_no_value": 0,
-+  "print_width": null,
-+  "read_only": 1,
-+  "read_only_depends_on": null,
-+  "report_hide": 0,
-+  "reqd": 0,
-+  "search_index": 0,
-+  "show_dashboard": 0,
-+  "sort_options": 0,
-+  "translatable": 0,
-+  "unique": 0,
-+  "width": null
-  }
- ]
-\ No newline at end of file
-diff --git a/business_needed_solutions/hooks.py b/business_needed_solutions/hooks.py
-index ff1f84b..9956f68 100644
---- a/business_needed_solutions/hooks.py
-+++ b/business_needed_solutions/hooks.py
-@@ -67,7 +67,9 @@ doctype_js = {
- # doctype_list_js = {"doctype" : "public/js/doctype_list.js"}
- doctype_list_js = {
-     "Delivery Note" : "public/js/delivery_note_list.js",
--    "Purchase Receipt" : "public/js/purchase_receipt_list.js"
-+    "Purchase Receipt" : "public/js/purchase_receipt_list.js",
-+    "Sales Invoice" : "public/js/sales_invoice_list.js",
-+    "Purchase Invoice" : "public/js/purchase_invoice_list.js"
- }
- # doctype_tree_js = {"doctype" : "public/js/doctype_tree.js"}
- # doctype_calendar_js = {"doctype" : "public/js/doctype_calendar.js"}
-@@ -186,7 +188,8 @@ doc_events = {
-         "on_submit": [
-             "business_needed_solutions.business_needed_solutions.overrides.submission_restriction.validate_submission_permission",
-             "business_needed_solutions.business_needed_solutions.utils.update_delivery_note_status_for_bns_internal"
--        ]
-+        ],
-+        "on_cancel": "business_needed_solutions.business_needed_solutions.utils.validate_delivery_note_cancellation"
-     },
-     "Purchase Receipt": {
-         "on_submit": [
-@@ -198,11 +201,17 @@ doc_events = {
-         "on_submit": "business_needed_solutions.business_needed_solutions.overrides.submission_restriction.validate_submission_permission"
-     },
-     "Sales Invoice": {
--        "on_submit": "business_needed_solutions.business_needed_solutions.overrides.submission_restriction.validate_submission_permission",
-+        "on_submit": [
-+            "business_needed_solutions.business_needed_solutions.overrides.submission_restriction.validate_submission_permission",
-+            "business_needed_solutions.business_needed_solutions.utils.update_sales_invoice_status_for_bns_internal"
-+        ],
-         "validate": "business_needed_solutions.business_needed_solutions.overrides.stock_update_validation.validate_stock_update_or_reference"
-     },
-     "Purchase Invoice": {
--        "on_submit": "business_needed_solutions.business_needed_solutions.overrides.submission_restriction.validate_submission_permission",
-+        "on_submit": [
-+            "business_needed_solutions.business_needed_solutions.overrides.submission_restriction.validate_submission_permission",
-+            "business_needed_solutions.business_needed_solutions.utils.update_purchase_invoice_status_for_bns_internal"
-+        ],
-         "validate": "business_needed_solutions.business_needed_solutions.overrides.stock_update_validation.validate_stock_update_or_reference"
-     },
-     "Journal Entry": {
-diff --git a/business_needed_solutions/public/js/sales_invoice_form.js b/business_needed_solutions/public/js/sales_invoice_form.js
-index d207085..9d7ec0e 100644
---- a/business_needed_solutions/public/js/sales_invoice_form.js
-+++ b/business_needed_solutions/public/js/sales_invoice_form.js
-@@ -63,5 +63,77 @@ frappe.ui.form.on('Sales Invoice', {
-                 d.show();
-             }, __('e-Waybill'));
-         }
-+        
-+        // BNS Internal Purchase Invoice/Receipt buttons
-+        // Show if: status is "BNS Internally Transferred" and docstatus == 1
-+        if (
-+            frm.doc.status === "BNS Internally Transferred" &&
-+            frm.doc.docstatus == 1
-+        ) {
-+            // Always show Purchase Invoice button if status is BNS Internally Transferred
-+            // (assume PI needs to be created when SI is generated)
-+            frm.add_custom_button(
-+                __("BNS Internal Purchase Invoice"),
-+                function() {
-+                    frappe.model.open_mapped_doc({
-+                        method: "business_needed_solutions.business_needed_solutions.utils.make_bns_internal_purchase_invoice",
-+                        frm: frm,
-+                    });
-+                },
-+                __("Create")
-+            );
-+            
-+            // Check if Purchase Receipt button should be shown
-+            // Show if: any item maintains stock (is_stock_item) OR if SI is made from Delivery Note
-+            if (frm.doc.items && frm.doc.items.length > 0) {
-+                // Check if SI is made from Delivery Note (items have delivery_note reference)
-+                let has_dn_reference = frm.doc.items.some(item => item.delivery_note);
-+                
-+                if (has_dn_reference) {
-+                    // Show PR button immediately if DN reference exists
-+                    frm.add_custom_button(
-+                        __("BNS Internal Purchase Receipt"),
-+                        function() {
-+                            frappe.model.open_mapped_doc({
-+                                method: "business_needed_solutions.business_needed_solutions.utils.make_bns_internal_purchase_receipt_from_si",
-+                                frm: frm,
-+                            });
-+                        },
-+                        __("Create")
-+                    );
-+                    frm.page.set_inner_btn_group_as_primary(__("Create"));
-+                } else {
-+                    // Check if any item maintains stock by fetching from Item doctype
-+                    let item_codes = frm.doc.items
-+                        .filter(item => item.item_code)
-+                        .map(item => item.item_code);
-+                    
-+                    if (item_codes.length > 0) {
-+                        frappe.db.get_list("Item", {
-+                            filters: {
-+                                name: ["in", item_codes],
-+                                is_stock_item: 1
-+                            },
-+                            fields: ["name"],
-+                            limit: 1
-+                        }).then(r => {
-+                            if (r && r.length > 0) {
-+                                frm.add_custom_button(
-+                                    __("BNS Internal Purchase Receipt"),
-+                                    function() {
-+                                        frappe.model.open_mapped_doc({
-+                                            method: "business_needed_solutions.business_needed_solutions.utils.make_bns_internal_purchase_receipt_from_si",
-+                                            frm: frm,
-+                                        });
-+                                    },
-+                                    __("Create")
-+                                );
-+                                frm.page.set_inner_btn_group_as_primary(__("Create"));
-+                            }
-+                        });
-+                    }
-+                }
-+            }
-+        }
-     }
- });
-\ No newline at end of file
